Inspired by code in drizzle-orm (with some modifications).
